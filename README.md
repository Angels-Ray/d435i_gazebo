# d435i_gazebo

Simulation assets and Gazebo sensor plugin for the Intel RealSense D435i depth camera.

## Overview
- Provides a Gazebo model and URDF/Xacro description of the RealSense D435i.
- Implements a custom Gazebo `ModelPlugin` that publishes color, depth, and aligned depth images along with calibrated camera info topics via ROS.
- Ships example launch files and a sample Gazebo world for quick validation of the virtual sensor.

This package targets ROS 1 catkin workspaces running Gazebo Classic (tested with ROS Noetic + Gazebo 11). Other ROS 1 distributions should work as long as the listed dependencies are available.

## Package Layout
- `include/` and `src/`: C++ implementation of `d435i_gazebo_plugin` (`libd435i_gazebo_plugin.so`).
- `urdf/`: Xacro-based URDF for the camera body (`d435i_robot.urdf.xacro`).
- `meshes/`: STL and material assets referenced by the URDF.
- `launch/`: Launch files for spawning the camera into Gazebo.
- `worlds/`: Demo world used by `d435i_gazebo.launch`.

## Dependencies
All runtime and build dependencies are declared in `package.xml`. Install them via `rosdep`:

```bash
rosdep install --from-paths src --ignore-src -r -y
```

Key ROS package dependencies:
- `gazebo_ros`, `gazebo_dev`
- `roscpp`
- `sensor_msgs`
- `image_transport`
- `camera_info_manager`
- `xacro`

## Building
Clone this repository into a catkin workspace (e.g., `~/catkin_ws/src`) and build with your preferred catkin tool:

```bash
cd ~/catkin_ws
catkin_make  # or catkin build
source devel/setup.bash
```

## Running the Simulation
Launch the bundled demo world with the camera model:

```bash
roslaunch d435i_gazebo d435i_gazebo.launch
```

For an empty-world deployment, use:

```bash
roslaunch d435i_gazebo d435i_simple.launch
```

Both launch files spawn the URDF description, bring up the robot_state_publisher, and load the Gazebo plugin. Adjust `use_sim_time` or spawn position arguments inside the launch files as needed.

## Published Topics
All topics are namespaced under `<cameraName>` (defaults to `camera`). The plugin advertises via `image_transport::CameraPublisher`, so each image topic has a paired camera info topic automatically.

| Topic | Type | Description |
| --- | --- | --- |
| `<camera>/color/image_raw` | `sensor_msgs/Image` | RGB image generated by the Gazebo color camera. |
| `<camera>/color/camera_info` | `sensor_msgs/CameraInfo` | Intrinsic calibration for the color stream. |
| `<camera>/depth/image_raw` | `sensor_msgs/Image` (16UC1) | Depth image (millimeters, zeroed outside clipping range). |
| `<camera>/depth/camera_info` | `sensor_msgs/CameraInfo` | Intrinsic calibration for the depth stream. |
| `<camera>/aligned_depth_to_color/image_raw` | `sensor_msgs/Image` (16UC1) | Depth image reprojected into the color optical frame. |
| `<camera>/aligned_depth_to_color/camera_info` | `sensor_msgs/CameraInfo` | Uses the color intrinsics for the aligned depth image. |

## Plugin Parameters
The following SDF elements configure the plugin when attached to a robot model:

| Parameter | Default | Description |
| --- | --- | --- |
| `robotNamespace` | `""` | ROS namespace used for publishers and services. |
| `cameraName` | `"camera"` | Base name for topics and TF frames. |
| `colorFrameId` | `<cameraName>_color_optical_frame` | `frame_id` for color images. |
| `depthFrameId` | `<cameraName>_depth_optical_frame` | `frame_id` for depth images. |
| `updateRate` | `30.0` Hz | Target update rate for the plugin main loop. |
| `prefix` | `""` | Optional scoped name prefix for locating Gazebo sensors. |

Update the URDF/Xacro or SDF to override these defaults when embedding the plugin in custom robot descriptions.

## TF Frames
The URDF publishes the following TF frames via `robot_state_publisher` (suffixes depend on `cameraName`):
- `<cameraName>_link`
- `<cameraName>_color_optical_frame`
- `<cameraName>_depth_optical_frame`

Use `rviz` or `tf2_tools` to verify transforms when integrating with downstream perception pipelines.

## Contributing
Issues and pull requests are welcome. Please run `catkin_lint` and relevant Gazebo/ROS tests before submitting changes.

## License
Distributed under the Apache-2.0 license. Refer to `LICENSE` for the full license text and maintainer information.
